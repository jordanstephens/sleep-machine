{"version":3,"sources":["components/WeightedGraph/util.ts","components/ProgressMeter.tsx","components/icons/Triangle.tsx","components/icons/Square.tsx","components/PlayPauseButton.tsx","lib/graph.ts","components/Draggable.tsx","components/WeightedGraph/Edge.tsx","components/WeightedGraph/Node.tsx","components/WeightedGraph/Label.tsx","components/WeightedGraph/Point.tsx","components/WeightedGraph/index.tsx","components/MarkovChart.tsx","components/Slider.tsx","components/icons/Circle.tsx","components/icons/Sawtooth.tsx","components/RadioButtons.tsx","components/Controls.tsx","lib/machine.ts","components/NumberInput.tsx","components/SleepMachine.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["NOOP","Math","PI","rel2abs","value","SIZE","ProgressMeter","beat","viewBox","className","map","position","i","key","classnames","on","x","HALF","y","height","width","Triangle","props","points","Square","PlayPauseButton","playing","onClick","style","transform","rmap","src","dst","Error","smin","smax","dmin","dmax","normalize_proportions","values","length","sum","_","v","Edge","a","b","this","other","Graph","weights","radius","vertices","theta","order","sin","cos","max","normalize_absolute","Array","fill","chain","v1","v2","flatten","compact","uniqBy","sort","join","DraggableContext","React","createContext","Draggable","id","enabled","children","Consumer","context","onMouseDown","event","clientX","clientY","setOrigin","DraggableProvider","onMouseMove","handleDrag","onMouseUp","committed","onDrag","origin","state","destination","delta","setState","document","addEventListener","removeEventListener","Provider","Component","point_at_distance","x0","y0","slope","distance","Infinity","partial","sqrt","pow","point_radius","RECT","TRIANGLE","p1","p2","weight","selected","x1","y1","x2","y2","m","dx","sign","POINT_RADIUS","d1","d2","x1a","y1a","endpoints","min","midpoint_x","midpoint_y","rect_x","rect_y","t1_points","t2_points","strokeLinecap","markerEnd","data-index","fontSize","cursor","userSelect","dominantBaseline","textAnchor","toFixed","Node","point","cx","cy","r","Label","offset","size","text","Point","config","label","onMouseEnter","onMouseLeave","label_offset","label_size","DEFAULT_CONFIG","graph_radius","WeightedGraph","labels","onVertexMouseEnter","onVertexMouseLeave","onVertexClick","onWeightDrag","selected1","selected2","_config","graph","G","chart","active_weights","normalized_weights","refX","refY","markerWidth","markerHeight","orient","d","transformOrigin","edges","String","MarkovChart","current","next","onChange","meter","v0","abs","normalizedWeights","useState","cloneDeep","editWeights","setEditWeights","hovered","setHovered","setSelected","handleVertexClick","useCallback","index","s","handleVertexMouseEnter","handleVertexMouseLeave","useEffect","handleDocumentClick","target","classList","contains","window","focused","fade","parseInt","values_0","values_1","forEach","pivot_0","pivot_1","rem_0","value_0","error","console","Slider","dragging","setDragging","setValues","axis","minHeight","undefined","onDragStart","onDragEnd","Circle","Sawtooth","RadioButtons","name","options","title","_value","type","checked","htmlFor","BG_COLOR","WAVEFORM_OPTIONS","DELAY_TIME_OPTIONS","Controls","params","waveform","attack","ymin","ymax","ystep","styles","active","background","track","decay","sustain","release","delay_feedback","xmin","xmax","xstep","delay_wet","borderRadius","delay_time","chorus_frequency","chorus_depth","Tone","require","DEFAULT_PARAMS","tempo","chorus_delay_time","MAJOR_TRIAD","MINOR_TRIAD","SCALE_DEGREE_TRIADS","ROOT_OFFSETS","rand","floor","random","Machine","probabilities","generators","pattern","range","synth","updateParams","_params","Transport","bpm","update","Synth","ChordPattern","updateProbabilities","latencyHint","loop","loopStart","loopEnd","scheduleRepeat","t","Draw","schedule","emit","split","notes","note","trigger","col","VoseAliasMethod","start","stop","toggle","voice","get","oscillator","envelope","delay","wet","Time","delayTime","toNotation","feedback","chorus","frequency","depth","EventEmitter","root","degrees","shifts","Frequency","toNote","PingPongDelay","Chorus","PolySynth","set","Master","velocity","triggerAttackRelease","KEY","NumberInput","step","valid","isNaN","updateValue","throttle","localValue","setLocalValue","commitChange","keyHandlers","inputMode","onBlur","Number","onKeyDown","fn","keyCode","LABELS","machine","KEYCODE","SleepMachine","_setPlaying","setBeat","setCurrent","setNext","useMachine","setPlaying","handlePlayPause","machineState","handleKeyDown","activeElement","href","round","marginBottom","App","Boolean","location","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.039a97dc.chunk.js","sourcesContent":["export const SIZE = 100;\nexport const HALF = SIZE / 2;\nexport const CIRCUMFERENCE = 2 * Math.PI * HALF;\nexport const POINT_RADIUS = 5;\nexport const NOOP = () => {};\n\nexport const rel2abs = (value: number) => HALF + value;\n\nexport interface IConfig {\n  point_radius: number;\n  label_offset: number;\n  label_size: number;\n  graph_radius: number;\n}\n\nexport function generateConfig(point_radius: number, graph_radius: number): IConfig {\n  return {\n    point_radius,\n    label_offset: point_radius * 2,\n    label_size: point_radius * 0.8,\n    graph_radius\n  }\n}\n","\nimport React from 'react';\nimport classnames from 'classnames';\n\nimport { SIZE, HALF } from './WeightedGraph/util'\ninterface IProgressMeterProps {\n  beat: number;\n}\n\nconst PADDING = 4;\n\nconst ProgressMeter: React.FC<IProgressMeterProps> = ({ beat }) => (\n  <svg viewBox={`0 0 ${SIZE} ${SIZE}`} className=\"ProgressMeter\">\n    {[0, 1, 3, 2].map((position, i) => (\n      <rect\n        key={position}\n        className={classnames({\n          on: beat === position\n        })}\n        x={i % 2 === 0 ? 0 : HALF + (PADDING / 2)}\n        y={i < 2 ? 0 : HALF + (PADDING / 2)}\n        height={HALF - (PADDING / 2)}\n        width={HALF - (PADDING / 2)}\n      />\n    ))}\n  </svg>\n);\n\nexport default ProgressMeter;\n","import React from 'react';\nimport classnames from 'classnames';\n\nimport { SIZE, HALF } from '../WeightedGraph/util'\n\ninterface IProps {\n  className?: string;\n  style?: object;\n}\n\nconst Triangle: React.FC<IProps> = ({ className, ...props }) => (\n  <svg viewBox={`0 0 ${SIZE} ${SIZE}`} className={classnames('Triangle', className)} {...props}>\n    <polygon points={`0,${SIZE} ${HALF},0 ${SIZE},${SIZE}`} />\n  </svg>\n);\n\nexport default Triangle;\n","import React from 'react';\nimport classnames from 'classnames';\n\nimport { SIZE } from '../WeightedGraph/util'\n\ninterface IProps {\n  className?: string;\n}\n\nconst Square: React.FC<IProps> = ({ className }) => (\n  <svg viewBox={`0 0 ${SIZE} ${SIZE}`} className={classnames('Square', className)}>\n    <rect x={0} y={0} height={SIZE} width={SIZE} />\n  </svg>\n);\n\nexport default Square;\n","import React from 'react';\nimport Triangle from './icons/Triangle';\nimport Square from './icons/Square';\n\ninterface IProps {\n  playing: boolean;\n  onClick: (event: React.MouseEvent) => void\n}\n\nconst PlayPauseButton: React.FC<IProps> = ({ playing, onClick }) => (\n  <button onClick={onClick} className=\"PlayPauseButton\">\n    {playing\n      ? <Square />\n      : <Triangle style={{ transform: 'rotate(90deg)' }} />\n    }\n  </button>\n)\n\nexport default PlayPauseButton\n","import _ from 'lodash'\n\nexport const deg2rad = (deg: number) => (deg * Math.PI) / 180;\n\nexport type Vertex = number;\nexport type Point = [number, number, number];\nexport type Chart = Point[];\nexport type Vector = number[];\nexport type Matrix = Vector[];\n\nexport type Range = [number, number];\nexport function rmap(value: number, src: Range, dst: Range): number{\n  if (value == null) throw new Error('Invalid value');\n  const [smin, smax] = src;\n  const [dmin, dmax] = dst;\n  if (smin >= smax) throw new Error(`Invalid src Range: [${smin}, ${smax}]`);\n  if (dmin >= dmax) throw new Error(`Invalid dst Range: [${dmin}, ${dmax}]`);\n  return (value - smin) * (dmax - dmin) / (smax - smin) + dmin;\n}\n\nexport function normalize_proportions(values: Vector = []) {\n  if (!values.length) return [];\n  const sum = _.sum(values);\n  if (sum === 0) return values.map((v) => 0);\n  const src: Range = [0, sum];\n  const dst: Range = [0, 1];\n  return values.map((value) => rmap(value, src, dst));\n}\nexport function normalize_absolute(values: Vector = []) {\n  if (!values.length) return [];\n  const max = Math.max(...values)\n  const src: Range = [0, max === 0 ? 1 : max];\n  const dst: Range = [0, 1];\n  return values.map((value) => rmap(value, src, dst));\n}\n\nconst EPSILON = 0.00005;\nexport function redistribute(values: Vector, index: number, delta: number) {\n  if (index > values.length - 1) throw new Error('index out of bounds');\n  if (delta < -1 || delta > 1) throw new Error('delta out of bounds');\n  if (values.length < 2) throw new Error('vector length must be greater than 1');\n  values.forEach((value) => {\n    if (value < 0 || value > 1) {\n      throw new Error('vector not normalized: value out of bounds');\n    }\n  })\n  const sum = _.sum(values);\n  if (sum < 1 - EPSILON || sum > 1 + EPSILON) {\n    throw new Error(`vector not normalized: proportions sum to ${sum}`);\n  }\n  const pivot_0 = values[index];\n  const pivot_1 = pivot_0 + delta;\n  if (pivot_1 < 0 || pivot_1 > 1) {\n    throw new Error('delta effect out of bounds');\n  }\n  const rem_0 = sum - pivot_0;\n  const rem_1 = sum - pivot_1;\n  // if rem_0 is zero, that means that the pivot was 100% of the value and the the differences needs to be equally distributed among the rest of the values\n  if (rem_0 === 0) {\n    // split the remainder up between each value except the pivot\n    const value = rem_1 / (values.length - 1)\n    return values.map((value_0, i) => (i === index) ? pivot_1 : value);\n  }\n  return values.map((value_0, i) => {\n    if (i === index) return pivot_1;\n    return value_0 + (-1 * delta * (value_0 / rem_0))\n  })\n}\n\nexport class Edge {\n  a: Vertex;\n  b: Vertex;\n\n  constructor(a: Vertex, b: Vertex) {\n    this.a = a;\n    this.b = b;\n  }\n\n  equals(other: Edge) {\n    return (this.a === other.a && this.b === other.b)\n      || (this.a === other.b && this.b === other.a);\n  }\n\n  includes(x: Vertex) {\n    return x === this.a || x === this.b;\n  }\n}\n\nexport class Graph {\n  weights: number[];\n  constructor(weights: number[]) {\n    this.weights = weights;\n  }\n\n  get order(): number {\n    return this.weights.length;\n  }\n\n  get normalized_weights(): number[] {\n    return normalize_absolute(this.weights);\n  }\n\n  get vertices(): Vertex[] {\n    return new Array(this.order).fill(0).map((x, i) => i)\n  }\n\n  get edges(): Edge[] {\n    return _.chain(this.vertices)\n      .map((v1) => this.vertices.map((v2) => v1 !== v2 && new Edge(v1, v2)))\n      .flatten()\n      .compact()\n      .uniqBy(({ a, b }) => [a, b].sort().join(':'))\n      .value();\n  }\n\n  chart(radius: number): Chart {\n    return this.vertices.map((i) => {\n      const theta = deg2rad((360 / this.order) * i);\n      const x = radius * Math.sin(theta);\n      const y = -1 * radius * Math.cos(theta);\n      return [x, y, theta];\n    })\n  }\n}\n\n","import React, { Fragment } from 'react';\n\ntype MousePosition = { x: number, y: number };\ntype DragOrigin = { id: string } & MousePosition;\nexport type DragEvent = {\n  id: string;\n  origin: MousePosition;\n  destination: MousePosition;\n  delta: MousePosition;\n  committed: boolean;\n}\n\ninterface IDraggableContext {\n  setOrigin: (origin: DragOrigin | null) => void;\n  origin: MousePosition | null;\n}\nconst DraggableContext = React.createContext<IDraggableContext | null>(null);\n\ninterface IDraggableProps {\n  id: string;\n  enabled: boolean;\n  children: React.ReactNode;\n}\n\nexport const Draggable: React.FC<IDraggableProps> = ({ id, enabled, children }) => {\n  if (!enabled) return <Fragment>{children}</Fragment>;\n  return (\n    <DraggableContext.Consumer>\n      {(context) => {\n        if (!context) throw new Error('Invariant violation: DraggableContext.Consumer rendered without a context');\n        function handleMouseDown(event: React.MouseEvent) {\n          const { clientX: x, clientY: y } = event;\n          context!.setOrigin({ id, x, y });\n        }\n        return (\n          <g onMouseDown={handleMouseDown}>\n            {children}\n          </g>\n        )\n      }}\n    </DraggableContext.Consumer>\n  );\n}\n\ninterface IDraggableProviderProps {\n  onDrag?: (event: DragEvent) => void;\n  children: React.ReactNode;\n}\n\ninterface IDraggableProviderState {\n  origin: DragOrigin | null;\n}\n\nexport class DraggableProvider extends React.Component<IDraggableProviderProps, IDraggableProviderState> {\n  constructor(props: IDraggableProviderProps) {\n    super(props);\n    this.state = {\n      origin: null\n    };\n  }\n\n  componentDidMount() {\n    if (!this.props.onDrag) return;\n    document.addEventListener('mouseup', this.onMouseUp);\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  componentWillUnmount() {\n    if (!this.props.onDrag) return;\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove = (event: MouseEvent) => {\n    this.handleDrag(false, event);\n  }\n\n  onMouseUp = (event: MouseEvent) => {\n    this.handleDrag(true, event);\n  }\n\n  handleDrag = (committed: boolean, event: MouseEvent) => {\n    const { onDrag } = this.props;\n    if (!onDrag) return;\n    const { origin } = this.state;\n    if (!origin) return;\n    const { id } = origin;\n    const destination = { x: event.clientX, y: event.clientY };\n    const delta = {\n      x: destination.x - origin.x,\n      y: destination.y - origin.y\n    };\n    onDrag({ id, origin, delta, destination, committed });\n    if (committed) {\n      this.setState({ origin: null });\n    }\n  }\n\n  render() {\n    const { children, onDrag } = this.props;\n    if (!onDrag) return children;\n\n    const { origin } = this.state;\n    const setOrigin = (origin: DragOrigin | null) => this.setState({ origin });\n    return (\n      <DraggableContext.Provider value={{ origin, setOrigin }}>\n        {children}\n      </DraggableContext.Provider>\n    );\n  }\n}\n","import React from 'react';\nimport classnames from 'classnames'\nimport { rel2abs, POINT_RADIUS } from './util';\nimport * as G from '../../lib/graph';\nimport { Draggable } from '../Draggable';\n\nfunction format_weight(value: number): string {\n  return `${(value * 100).toFixed(0)}%`;\n}\n\nfunction slope(x1: number, y1: number, x2: number, y2: number): number {\n  const dx = x2 - x1\n  if (dx === 0) return Infinity;\n  return (y2 - y1) / dx\n}\n\nfunction point_at_distance(x0: number, y0: number, slope: number, distance: number): [number, number] {\n  if (slope === 0) return [x0 + distance, y0];\n  if (slope === Infinity) return [x0, y0 + distance];\n  // https://www.geeksforgeeks.org/find-points-at-a-given-distance-on-a-line-of-given-slope\n  const partial = (distance * Math.sqrt(1 / (1 + Math.pow(slope, 2))))\n  return [x0 + partial, y0 + (slope * partial)]\n}\n\nfunction endpoints(p1: G.Point, p2: G.Point): [number, number, number, number] {\n  const d = POINT_RADIUS + 2\n  const [x1, y1] = p1.map(rel2abs);\n  const [x2, y2] = p2.map(rel2abs);\n  const m = slope(x1, y1, x2, y2);\n  const sign = Math.sign(m)\n  const desc = (m === 0 && x2 > x1)\n    || (m === Infinity && y2 > y1)\n    || (sign === 1 && x2 > x1)\n    || (sign === -1 && x2 > x1)\n  const [d1, d2] = desc ? [d, -d] : [-d, d]\n  const [x1a, y1a] = point_at_distance(x1, y1, m, d1);\n  const [x2a, y2a] = point_at_distance(x2, y2, m, d2);\n  return [x1a, y1a, x2a, y2a];\n}\n\ninterface IEdgeProps {\n  id: string;\n  p1: G.Point;\n  p2: G.Point;\n  weight?: number;\n  selected?: boolean;\n}\n\nconst RECT = {\n  WIDTH: 8,\n  HEIGHT: 8\n}\n\nconst TRIANGLE = {\n  WIDTH: 1.5,\n  HEIGHT: 1\n}\n\nconst Edge: React.FC<IEdgeProps> = ({ id, p1, p2, weight, selected }) => {\n  const [x1, y1, x2, y2] = endpoints(p1, p2);\n  const x = Math.min(x1, x2);\n  const y = Math.min(y1, y2);\n  const width = Math.max(x1, x2) - x;\n  const height = Math.max(y1, y2) - y;\n  const midpoint_x = x + (width / 2);\n  const midpoint_y = y + (height / 2);\n  const rect_x = midpoint_x - (RECT.WIDTH / 2);\n  const rect_y = midpoint_y - (RECT.HEIGHT / 2);\n  const t1_points = [\n    [midpoint_x - (TRIANGLE.WIDTH / 2), midpoint_y - (RECT.HEIGHT / 2)],\n    [midpoint_x, midpoint_y - (RECT.HEIGHT / 2) - TRIANGLE.HEIGHT],\n    [midpoint_x + (TRIANGLE.WIDTH / 2), midpoint_y - (RECT.HEIGHT / 2)],\n  ].map((x) => x.join(','))\n  const t2_points = [\n    [midpoint_x - (TRIANGLE.WIDTH / 2), midpoint_y + (RECT.HEIGHT / 2)],\n    [midpoint_x, midpoint_y + (RECT.HEIGHT / 2) + TRIANGLE.HEIGHT],\n    [midpoint_x + (TRIANGLE.WIDTH / 2), midpoint_y + (RECT.HEIGHT / 2)],\n  ].map((x) => x.join(','))\n  return (\n    <g>\n      <line\n        x1={x1}\n        y1={y1}\n        x2={x2}\n        y2={y2}\n        className={classnames('edge', {\n          selected: !!selected\n        })}\n        strokeLinecap=\"round\"\n        markerEnd={selected ? 'url(#selected-arrow)' : 'url(#arrow)'}\n      />\n      {weight && (\n        <g data-index={id}>\n          <Draggable id={id} enabled={true}>\n            <rect\n              x={rect_x}\n              y={rect_y}\n              width={RECT.WIDTH}\n              height={RECT.HEIGHT}\n              className=\"weight-box\"\n            />\n            <text\n              x={midpoint_x}\n              y={midpoint_y}\n              className=\"weight-label\"\n              style={{\n                fontSize: 3,\n                cursor: 'ns-resize',\n                userSelect: 'none'\n              }}\n              dominantBaseline=\"middle\"\n              textAnchor=\"middle\"\n            >\n              {format_weight(weight)}\n            </text>\n            <polygon className=\"edge-drag-triangle-up\" points={t1_points.join(' ')} />\n            <polygon className=\"edge-drag-triangle-down\" points={t2_points.join(' ')} />\n          </Draggable>\n        </g>\n      )}\n    </g>\n  );\n}\n\nexport default Edge;\n","import React from 'react';\nimport classnames from 'classnames'\nimport { rel2abs, NOOP } from './util';\nimport * as G from '../../lib/graph';\n\ninterface INodeProps {\n  point: G.Point;\n  radius: number;\n  weight: number;\n  className?: string;\n  onClick?: (event: React.MouseEvent) => void;\n}\n\nconst Node: React.FC<INodeProps> = ({ point, radius, weight, className, onClick = NOOP }) => {\n  const [x, y] = point;\n  return (\n    <circle\n      cx={rel2abs(x)}\n      cy={rel2abs(y)}\n      r={radius * weight}\n      className={classnames('vertex', className)}\n      onClick={onClick}\n    />\n  )\n}\n\nexport default Node;\n","import React from 'react';\nimport { rel2abs } from './util';\nimport * as G from '../../lib/graph';\n\ninterface ILabelProps {\n  point: G.Point;\n  offset: number;\n  size: number;\n  text: string;\n}\n\nconst Label: React.FC<ILabelProps> = ({ point, offset, size, text }) => {\n  const [x, y] = point;\n  return (\n    <text\n      x={rel2abs(x + (Math.sign(x) * offset))}\n      y={rel2abs(y + (Math.sign(y) * offset))}\n      textAnchor=\"middle\"\n      dominantBaseline=\"middle\"\n      className=\"label\"\n      style={{ fontSize: size }}\n    >\n      {text}\n    </text>\n  )\n}\n\nexport default Label;\n","\nimport React from 'react';\nimport * as G from '../../lib/graph';\nimport { IConfig } from './util'\nimport Node from './Node';\nimport Label from './Label';\n\ninterface IPointProps {\n  point: G.Point;\n  weight: number;\n  label?: string;\n  className?: string;\n  onClick?: (event: React.MouseEvent) => void;\n  onMouseEnter?: (event: React.MouseEvent) => void;\n  onMouseLeave?: (event: React.MouseEvent) => void;\n  config: IConfig;\n}\n\nconst Point: React.FC<IPointProps> = ({ point, config, weight, label, className, onClick, onMouseEnter, onMouseLeave }) => (\n  <g onClick={onClick} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave}>\n    <Label\n      text={label || \"\"}\n      point={point}\n      offset={config.label_offset}\n      size={config.label_size}\n    />\n\n    <Node\n      point={point}\n      radius={config.point_radius}\n      weight={1}\n      className=\"click-target\"\n    />\n\n    <Node\n      point={point}\n      radius={config.point_radius}\n      weight={weight}\n      className={className}\n    />\n  </g>\n);\n\nexport default Point;\n","import React from 'react';\nimport classnames from 'classnames'\nimport './WeightedGraph.css';\nimport {\n  SIZE,\n  POINT_RADIUS,\n  NOOP,\n  IConfig,\n  generateConfig\n} from './util';\nimport * as G from '../../lib/graph';\nimport Edge from './Edge';\nimport Point from './Point';\nimport { DraggableProvider, DragEvent } from '../Draggable';\n\nconst GRAPH_RADIUS = 33.33333;\nconst DEFAULT_CONFIG = generateConfig(POINT_RADIUS, GRAPH_RADIUS);\n\ninterface IProps {\n  labels?: string[];\n  weights: G.Vector;\n  selected1?: number;\n  selected2?: number;\n  onWeightDrag?: (event: DragEvent) => void;\n  onVertexClick?: (i: G.Vertex | null, event: React.MouseEvent) => void;\n  onVertexMouseEnter?: (i: G.Vertex, event: React.MouseEvent) => void;\n  onVertexMouseLeave?: (i: G.Vertex, event: React.MouseEvent) => void;\n  className?: string;\n  config?: IConfig\n}\n\nconst WeightedGraph: React.FC<IProps> = ({\n  labels = [],\n  weights = [],\n  onVertexMouseEnter = NOOP,\n  onVertexMouseLeave = NOOP,\n  onVertexClick = NOOP,\n  onWeightDrag,\n  className,\n  selected1,\n  selected2,\n  config: _config\n}) => {\n  const config = { ..._config, ...DEFAULT_CONFIG };\n  const graph = new G.Graph(weights);\n  const points = graph.chart(config.graph_radius);\n  const active_weights = graph.normalized_weights;\n  return (\n    <div className={classnames('WeightedGraph', className)}>\n      <DraggableProvider onDrag={onWeightDrag}>\n        <svg viewBox={`0 0 ${SIZE} ${SIZE}`}>\n          <defs>\n            <marker id=\"arrow\" viewBox=\"0 0 10 10\" refX=\"5\" refY=\"5\"\n              markerWidth=\"6\" markerHeight=\"6\"\n              orient=\"auto-start-reverse\"\n              className=\"edge-arrow\"\n            >\n              <path d=\"M 0 0 L 10 5 L 0 10 z\" />\n            </marker>\n            <marker id=\"selected-arrow\" viewBox=\"0 0 10 10\" refX=\"5\" refY=\"5\"\n              markerWidth=\"6\" markerHeight=\"6\"\n              orient=\"auto-start-reverse\"\n              className=\"edge-arrow selected\"\n            >\n              <path d=\"M 0 0 L 10 5 L 0 10 z\" />\n            </marker>\n          </defs>\n          <g style={{\n            transform: 'scale(1)',\n            transformOrigin: '50% 50%'\n          }}>\n            {graph.edges.map(({ a, b }) => {\n              const [p1, p2] = selected1 === a\n                ? [a, b]\n                : selected1 === b\n                  ? [b, a]\n                  : []\n              if (p1 == null || p2 == null) return null;\n              const weight = selected1 == null ? 0 : weights[p2]\n              if (weight === 0) return null;\n              return (\n                <Edge\n                  key={`${p1}:${p2}`}\n                  id={String(p2)}\n                  p1={points[p1]}\n                  p2={points[p2]}\n                  weight={onWeightDrag && weight}\n                  selected={selected1 === p1 && selected2 === p2}\n                />\n              )\n            })}\n            {points.map((point, i) => (\n              <Point\n                key={i}\n                point={point}\n                weight={selected1 === i ? 1 : active_weights[i]}\n                label={labels[i] || String(i)}\n                onClick={(event) => onVertexClick(i, event)}\n                onMouseEnter={(event) => onVertexMouseEnter(i, event)}\n                onMouseLeave={(event) => onVertexMouseLeave(i, event)}\n                className={classnames({\n                  selected1: selected1 === i,\n                  selected2: selected2 === i\n                })}\n                config={config}\n              />\n            ))}\n          </g>\n        </svg>\n      </DraggableProvider>\n    </div>\n  );\n};\n\nexport default WeightedGraph;\n","import React, { useState, useEffect, useCallback } from 'react';\nimport classnames from 'classnames';\nimport cloneDeep from 'lodash/cloneDeep'\nimport WeightedGraph from './WeightedGraph';\nimport { DragEvent } from './Draggable';\nimport * as G from '../lib/graph';\n\ninterface IMarkovChartProps {\n  weights: G.Matrix;\n  current: G.Vertex;\n  next?: G.Vertex;\n  labels: string[];\n  onChange: (weights: G.Matrix) => void;\n}\n\nfunction RangeMeter(dmax: number) {\n  return (v0: number, distance: number) => {\n    const vmax = 1;\n    const vmin = 0;\n    dmax = Math.max(dmax, Math.abs(distance));\n\n    const p = distance / dmax;\n    const vspan = distance >= 0\n      ? vmax - v0\n      : v0 - vmin\n\n    return v0 + (p * vspan);\n  }\n}\n\nconst MarkovChart: React.FC<IMarkovChartProps> = ({\n  current = 0,\n  next,\n  weights,\n  labels,\n  onChange\n}) => {\n  const meter = RangeMeter(200);\n  const normalizedWeights = weights.map(G.normalize_proportions);\n  const [editWeights, setEditWeights] = useState<G.Matrix>(cloneDeep(normalizedWeights));\n  const [hovered, setHovered] = useState<G.Vertex | null>(null);\n  const [selected, setSelected] = useState<G.Vertex | null>(null);\n\n  const handleVertexClick = useCallback((index: G.Vertex | null) => {\n    setSelected((s) => index === s ? null : index);\n  }, [])\n\n  function handleVertexMouseEnter(index: G.Vertex) {\n    setHovered(index);\n  }\n\n  function handleVertexMouseLeave() {\n    setHovered(null);\n  }\n\n  function handleWeightDrag(event: DragEvent) {\n    if (selected == null) return;\n    const index = parseInt(event.id, 10);\n    const values_0 = [...weights[selected]];\n    const v0 = values_0[index];\n    const { y } = event.delta;\n    const v1 = meter(v0, -1 * y);\n    const delta = v1 - v0;\n    try {\n      const values_1 = G.redistribute(values_0, index, delta);\n      editWeights[selected] = values_1;\n      setEditWeights([...editWeights]);\n    } catch (error) {\n      console.error(error);\n    }\n    if (event.committed) {\n      onChange([...editWeights])\n    }\n  }\n\n  useEffect(() => {\n    function handleDocumentClick(event: MouseEvent) {\n      if (!event.target) return;\n      const target = event.target as Element;\n      if (target.classList.contains('weight-label')) return\n      if (selected == null) return;\n      handleVertexClick(null);\n    };\n    window.addEventListener('mousedown', handleDocumentClick);\n    return () => window.removeEventListener('mousedown', handleDocumentClick);\n  }, [handleVertexClick, selected])\n\n  const focused = selected == null ? hovered : selected\n\n  return (\n    <div className=\"MarkovChart\">\n      <WeightedGraph\n        labels={labels}\n        weights={weights[current]}\n        className={classnames('active', {\n          fade: focused != null\n        })}\n        onVertexClick={(i) => {\n          if (selected) return;\n          handleVertexClick(i);\n        }}\n        onVertexMouseEnter={handleVertexMouseEnter}\n        onVertexMouseLeave={handleVertexMouseLeave}\n        selected1={current}\n        selected2={next}\n      />\n      {focused != null && (\n        <WeightedGraph\n          labels={labels}\n          weights={editWeights[focused]}\n          selected1={focused}\n          className=\"selected\"\n          onVertexClick={handleVertexClick}\n          onVertexMouseEnter={handleVertexMouseEnter}\n          onVertexMouseLeave={handleVertexMouseLeave}\n          onWeightDrag={handleWeightDrag}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default MarkovChart;\n","import React, { useState } from 'react';\nimport ReactInputSlider, { InputSliderProps } from 'react-input-slider';\n\ninterface IValues {\n  x?: number;\n  y?: number;\n}\n\ninterface IProps extends InputSliderProps {\n  onChange: (values: IValues) => void;\n}\n\nconst Slider: React.FC<IProps> = ({ x, y, onChange, ...props }) => {\n  const [dragging, setDragging] = useState<boolean>(false);\n  const [values, setValues] = useState<IValues>({ x, y });\n\n  function handleChange(values: IValues) {\n    setValues(values);\n    onChange(values);\n  }\n\n  return (\n    <div\n      style={{\n        width: props.axis !== 'y' ? '100%' : 'auto',\n        minHeight: props.axis !== 'y' ? '100px' : undefined\n      }}\n    >\n      <ReactInputSlider\n        {...props}\n        x={dragging && values.x ? values.x : x}\n        y={dragging && values.y ? values.y : y}\n        onChange={handleChange}\n        onDragStart={() => setDragging(true)}\n        onDragEnd={() => setDragging(false)}\n      />\n    </div>\n  )\n}\n\nexport default Slider\n","import React from 'react';\nimport classnames from 'classnames';\n\nimport { SIZE, HALF } from '../WeightedGraph/util'\n\ninterface IProps {\n  className?: string;\n}\n\nconst Circle: React.FC<IProps> = ({ className }) => (\n  <svg viewBox={`0 0 ${SIZE} ${SIZE}`} className={classnames('Circle', className)}>\n    <circle cx={HALF} cy={HALF} r={HALF} />\n  </svg>\n);\n\nexport default Circle;\n","import React from 'react';\nimport classnames from 'classnames';\n\nimport { SIZE } from '../WeightedGraph/util'\n\ninterface IProps {\n  className?: string;\n}\n\nconst Sawtooth: React.FC<IProps> = ({ className }) => (\n  <svg viewBox={`0 0 ${SIZE} ${SIZE}`} className={classnames('Sawtooth', className)}>\n    <polygon points={`0,${SIZE} ${SIZE},0 ${SIZE}, ${SIZE}`} />\n  </svg>\n);\n\nexport default Sawtooth;\n","import React from 'react';\n\ninterface RadioOption {\n  value: string;\n  title?: string;\n  label: React.ReactNode;\n}\n\ninterface IProps {\n  name: string;\n  value: string;\n  options: RadioOption[];\n  onChange: (value: string) => void;\n}\n\nconst RadioButtons: React.FC<IProps> = ({ name, value, options, onChange }) => (\n  <div className=\"RadioButtons\">\n    {options.map(({ label, title, value: _value }) => (\n      <div className=\"RadioButton\" key={_value}>\n        <input\n          type=\"radio\"\n          name={name}\n          id={_value}\n          value={_value}\n          onChange={() => onChange(_value)}\n          checked={_value === value}\n        />\n        <label htmlFor={_value} title={title}>\n          {label}\n        </label>\n      </div>\n    ))}\n  </div>\n)\n\nexport default RadioButtons;\n","import React from 'react';\nimport Slider from './Slider';\nimport { Params, PartialParams, Waveform, DelayTime } from '../lib/machine'\nimport Square from './icons/Square';\nimport Circle from './icons/Circle';\nimport Triangle from './icons/Triangle';\nimport Sawtooth from './icons/Sawtooth';\nimport RadioButtons from './RadioButtons';\n\nconst BG_COLOR = 'hsla(0, 0%, 0%, 0.4)'\nconst FG_COLOR = 'grey'\nconst FADER_HEIGHT = '100px'\n\nconst WAVEFORM_OPTIONS = [\n  {\n    value: 'sine',\n    title: 'Sine',\n    label: <Circle className=\"waveform-icon\" />\n  },\n  {\n    value: 'square',\n    title: 'Square',\n    label: <Square className=\"waveform-icon\" />\n  },\n  {\n    value: 'triangle',\n    title: 'Triangle',\n    label: <Triangle className=\"waveform-icon\" />\n  },\n  {\n    value: 'sawtooth',\n    title: 'Sawtooth',\n    label: <Sawtooth className=\"waveform-icon\" />\n  }\n]\n\nconst DELAY_TIME_OPTIONS = [\n  { value: '4t', label: '4t' },\n  { value: '4n', label: '4' },\n  { value: '8t', label: '8t' },\n  { value: '8n', label: '8' }\n]\n\ninterface IControlsProps {\n  beat: number;\n  params: Params;\n  onChange: (params: PartialParams) => void;\n}\n\nconst Controls: React.FC<IControlsProps> = ({ params, onChange }) => {\n  return (\n    <form className=\"Controls\">\n      <fieldset className=\"form-col waveform\">\n        <label className=\"form-row\" htmlFor=\"waveform\">\n          Waveform\n        </label>\n        <div className=\"form-row\">\n          <RadioButtons\n            name=\"waveform\"\n            value={params.waveform}\n            onChange={(value) => onChange({ waveform: value as Waveform })}\n            options={WAVEFORM_OPTIONS}\n          />\n        </div>\n      </fieldset>\n      <fieldset className=\"form-col envelope\">\n        <label className=\"form-row\" htmlFor=\"envelope\">\n          Envelope\n        </label>\n        <div className=\"form-row\">\n          <div className=\"fader-bank\">\n            <div className=\"fader-container\">\n              <Slider\n                axis=\"y\"\n                y={params.attack}\n                ymin={0.01}\n                ymax={1.0}\n                ystep={0.01}\n                onChange={({ y }) => onChange({ attack: y })}\n                styles={{\n                  active: {\n                    background: FG_COLOR\n                  },\n                  track: {\n                    background: BG_COLOR,\n                    cursor: 'move-y',\n                    height: FADER_HEIGHT\n                  }\n                }}\n              />\n              <label className=\"fader-label\">A</label>\n            </div>\n            <div className=\"fader-container\">\n              <Slider\n                axis=\"y\"\n                y={params.decay}\n                ymin={0.01}\n                ymax={1.0}\n                ystep={0.01}\n                onChange={({ y }) => onChange({ decay: y })}\n                styles={{\n                  active: {\n                    background: FG_COLOR\n                  },\n                  track: {\n                    background: BG_COLOR,\n                    cursor: 'move-y',\n                    height: FADER_HEIGHT\n                  }\n                }}\n              />\n              <label className=\"fader-label\">D</label>\n            </div>\n            <div className=\"fader-container\">\n              <Slider\n                axis=\"y\"\n                y={params.sustain}\n                ymin={0.01}\n                ymax={1.0}\n                ystep={0.01}\n                onChange={({ y }) => onChange({ sustain: y })}\n                styles={{\n                  active: {\n                    background: FG_COLOR\n                  },\n                  track: {\n                    background: BG_COLOR,\n                    cursor: 'move-y',\n                    height: FADER_HEIGHT\n                  }\n                }}\n              />\n              <label className=\"fader-label\">S</label>\n            </div>\n            <div className=\"fader-container\">\n              <Slider\n                axis=\"y\"\n                y={params.release}\n                ymin={0.01}\n                ymax={1.0}\n                ystep={0.01}\n                onChange={({ y }) => onChange({ release: y })}\n                styles={{\n                  active: {\n                    background: FG_COLOR\n                  },\n                  track: {\n                    background: BG_COLOR,\n                    cursor: 'move-y',\n                    height: FADER_HEIGHT\n                  }\n                }}\n              />\n              <label className=\"fader-label\">R</label>\n            </div>\n            <div className=\"fader-container\">\n              <Slider\n                axis=\"y\"\n                y={params.width}\n                ymin={0.1}\n                ymax={1.0}\n                ystep={0.1}\n                onChange={({ y }) => onChange({ width: y })}\n                styles={{\n                  active: {\n                    background: FG_COLOR,\n                  },\n                  track: {\n                    background: BG_COLOR,\n                    cursor: 'move-y',\n                    height: FADER_HEIGHT\n                  }\n                }}\n              />\n              <label className=\"fader-label\">W</label>\n            </div>\n          </div>\n        </div>\n      </fieldset>\n      <fieldset className=\"form-col delay\">\n        <label className=\"form-row\" htmlFor=\"delay_wet\">\n          Delay\n        </label>\n        <div className=\"form-row\">\n          <Slider\n            axis=\"xy\"\n            x={params.delay_feedback}\n            xmin={0.0}\n            xmax={1.0}\n            xstep={0.01}\n            y={params.delay_wet}\n            ymin={0.0}\n            ymax={1.0}\n            ystep={0.01}\n            onChange={({ x, y }) => onChange({\n              delay_feedback: x,\n              delay_wet: y\n            })}\n            styles={{\n              track: {\n                background: BG_COLOR,\n                borderRadius: '4px',\n                cursor: 'move',\n                height: FADER_HEIGHT,\n                width: '100%'\n              }\n            }}\n          />\n        </div>\n      </fieldset>\n      <fieldset className=\"form-col delay-time\">\n        <label className=\"form-row\" htmlFor=\"delay_time\">\n          Delay Time\n        </label>\n        <div className=\"form-row\">\n          <RadioButtons\n            name=\"delay_time\"\n            value={params.delay_time}\n            onChange={(value) => onChange({ delay_time: value as DelayTime })}\n            options={DELAY_TIME_OPTIONS}\n          />\n        </div>\n      </fieldset>\n      <fieldset className=\"form-col chorus\">\n        <label className=\"form-row\" htmlFor=\"chorus_frequency\">\n          Chorus\n        </label>\n        <div className=\"form-row\">\n          <Slider\n            axis=\"xy\"\n            x={params.chorus_frequency}\n            xmin={0.0}\n            xmax={20.0}\n            xstep={0.1}\n            y={params.chorus_depth}\n            ymin={0.0}\n            ymax={1.0}\n            ystep={0.01}\n            onChange={({ x, y }) => onChange({\n              chorus_frequency: x,\n              chorus_depth: y\n            })}\n            styles={{\n              track: {\n                background: BG_COLOR,\n                borderRadius: '4px',\n                cursor: 'move',\n                height: FADER_HEIGHT,\n                width: '100%'\n              }\n            }}\n          />\n        </div>\n      </fieldset>\n    </form>\n  )\n}\n\nexport default Controls;\n","import _ from 'lodash';\nimport { VoseAliasMethod } from 'vose-alias-method';\nimport { EventEmitter } from 'events';\n\nconst Tone = require('tone');\n\nexport type Waveform = 'sine' | 'square' | 'triangle' | 'sawtooth'\nexport type DelayTime = '1m' | '2n' | '4n' | '4t' | '8n' | '8t'\n\nexport interface PartialParams {\n  tempo?: number;\n  waveform?: Waveform;\n  attack?: number;\n  decay?: number;\n  sustain?: number;\n  release?: number;\n  delay_wet?: number;\n  delay_time?: DelayTime;\n  delay_feedback?: number;\n  chorus_frequency?: number;\n  chorus_delay_time?: number;\n  chorus_depth?: number;\n  width?: number;\n}\n\nexport interface Params {\n  tempo: number;\n  waveform: Waveform;\n  attack: number;\n  decay: number;\n  sustain: number;\n  release: number;\n  delay_wet: number;\n  delay_time: DelayTime;\n  delay_feedback: number;\n  chorus_frequency: number;\n  chorus_delay_time: number;\n  chorus_depth: number;\n  width: number;\n}\n\nconst DEFAULT_PARAMS: Params = {\n  tempo: 90,\n  waveform: 'sine',\n  attack: 0.01,\n  decay: 0.5,\n  sustain: 0.1,\n  release: 0.5,\n  delay_wet: 0.5,\n  delay_time: '4n',\n  delay_feedback: 0.33,\n  chorus_frequency: 4,\n  chorus_delay_time: 1.5,\n  chorus_depth: 0.25,\n  width: 0.1,\n};\n\nconst C4 = 48;\nconst MAJOR_TRIAD = [0, 4, 7];\nconst MINOR_TRIAD = [0, 3, 7];\nconst DIMINISHED_TRIAD = [0, 3, 6];\nconst SCALE_DEGREE_TRIADS = [\n  MAJOR_TRIAD,\n  MINOR_TRIAD,\n  MINOR_TRIAD,\n  MAJOR_TRIAD,\n  MAJOR_TRIAD,\n  MINOR_TRIAD,\n  DIMINISHED_TRIAD\n];\n\nconst ROOT_OFFSETS = [0, 2, 4, 5, 7, 9, 11];\n\nconst rand = (min: number, max: number) => Math.floor(Math.random() * (max - min) + min);\n\nexport default class Machine extends EventEmitter {\n  generators: VoseAliasMethod[];\n  probabilities: number[][];\n  pattern: ChordPattern;\n  current: number;\n  range: number;\n  synth: Synth;\n\n  constructor(probabilities: number[][], params: PartialParams = {}) {\n    super();\n    params = { ...DEFAULT_PARAMS, ...params }\n    this.synth = new Synth(params as Params);\n    this.current = 0;\n    this.range = 2;\n    this.pattern = new ChordPattern(this.current, this.range);\n    this.probabilities = [];\n    this.generators = [];\n    this.updateParams(params);\n    this.updateProbabilities(probabilities);\n\n    Tone.Transport.latencyHint = \"playback\"\n    Tone.Transport.loop = true;\n    Tone.Transport.loopStart = 0;\n    Tone.Transport.loopEnd = '1m';\n\n    // half way through a loop\n    Tone.Transport.scheduleRepeat((t: number) => {\n      Tone.Draw.schedule(() => {\n        const next = this.next(this.current);\n        this.emit('select', next, this.current)\n        this.current = next;\n      }, t);\n    }, '1:0:0', '0:2:0');\n\n    // start of each loop\n    Tone.Transport.scheduleRepeat((t: number) => {\n      Tone.Draw.schedule(() => {\n        this.pattern = new ChordPattern(this.current, this.range);\n        this.emit('change', this.pattern, this.current)\n      }, t);\n    }, '1:0:0', '0:0:0');\n\n    // quarter notes\n    Tone.Transport.scheduleRepeat((t: number) => {\n      Tone.Draw.schedule(() => {\n        const { position } = Tone.Transport\n        const beat = parseInt(position.split(':')[1], 10);\n        this.emit('beat', beat);\n      }, t);\n    }, '0:0:1', '0:0:0');\n\n    // eighth notes\n    Tone.Transport.scheduleRepeat((t: number) => {\n      const i = rand(0, this.pattern.notes.length)\n      const note = this.pattern.notes[i];\n      this.synth.trigger(note);\n    }, '0:0:2', '0:0:0');\n  }\n\n  get params(): Params {\n    return {\n      tempo: Tone.Transport.bpm.value,\n      waveform: this.synth.voice.get('oscillator').oscillator.type,\n      attack: this.synth.voice.get('envelope').envelope.attack,\n      decay: this.synth.voice.get('envelope').envelope.decay,\n      sustain: this.synth.voice.get('envelope').envelope.sustain,\n      release: this.synth.voice.get('envelope').envelope.release,\n      delay_wet: this.synth.delay.wet.value,\n      delay_time: Tone.Time(this.synth.delay.delayTime.value).toNotation(),\n      delay_feedback: this.synth.delay.feedback.value,\n      chorus_frequency: this.synth.chorus.frequency.value,\n      chorus_delay_time: this.synth.chorus.delayTime,\n      chorus_depth: this.synth.chorus.depth,\n      width: this.synth.width,\n    }\n  }\n\n  updateParams = (_params: PartialParams = {}) => {\n    const params = { ...this.params, ..._params };\n    Tone.Transport.bpm.value = params.tempo;\n    this.synth.update(params);\n  }\n\n  updateProbabilities(probabilities: number[][]) {\n    this.probabilities = probabilities;\n    this.generators = probabilities.map((col) => new VoseAliasMethod(col));\n  }\n\n  next(i: number) {\n    return this.generators[i].next();\n  }\n\n  start() {\n    if (Tone.Transport.state === 'started') return;\n    Tone.Transport.start();\n  }\n\n  stop() {\n    Tone.Transport.stop();\n  }\n\n  toggle() {\n    Tone.Transport.toggle()\n  }\n\n  get state() {\n    return Tone.Transport.state\n  }\n}\n\nclass ChordPattern {\n  notes: number[];\n  constructor(index: number, range: number) {\n    const root = C4 + ROOT_OFFSETS[index];\n    const degrees = SCALE_DEGREE_TRIADS[index];\n    const shifts = new Array(range).fill(0).map((x, i) => i);\n    this.notes = _.flatten(\n      shifts.map((delta) => degrees.map((d) => root + d + (delta * 12)))\n    ).map((note) => Tone.Frequency(note, 'midi').toNote());\n  }\n}\n\nclass Synth {\n  delay: any;\n  chorus: any;\n  voice: any;\n  width: number;\n\n  constructor(params: Params) {\n    this.width = params.width;\n    this.delay = new Tone.PingPongDelay(params.delay_time, params.delay_feedback)\n    this.delay.wet.value = params.delay_wet;\n    this.chorus = new Tone.Chorus(params.chorus_frequency, params.chorus_delay_time, params.chorus_depth);\n    this.voice = new Tone.PolySynth(4, Tone.Synth, {\n      oscillator: { type: params.waveform }\n    });\n    this.voice.set({\n      envelope: {\n        attack: params.attack,\n        decay: params.decay,\n        sustain: params.sustain,\n        release: params.release\n      }\n    })\n    this.voice.chain(this.chorus, this.delay, Tone.Master);\n  }\n\n  update(params: Params) {\n    this.width = params.width;\n    this.voice.set({\n      oscillator: { type: params.waveform },\n      envelope: {\n        attack: params.attack,\n        decay: params.decay,\n        sustain: params.sustain,\n        release: params.release,\n      }\n    })\n\n    this.delay.wet.value = params.delay_wet;\n    this.delay.delayTime.value = params.delay_time;\n    this.delay.feedback.value = params.delay_feedback;\n    this.chorus.frequency.value = params.chorus_frequency;\n    this.chorus.delayTime = params.chorus_delay_time;\n    this.chorus.depth = params.chorus_depth;\n  }\n\n  trigger(note: number | string, velocity: number = 0.1) {\n    this.voice.triggerAttackRelease(note, this.width, undefined, velocity);\n  }\n}\n","import React, { useState, ChangeEvent, HTMLProps } from 'react';\nimport throttle from 'lodash/throttle';\n\nconst KEY = {\n  UP: 38,\n  DOWN: 40,\n}\n\ntype InputProps = Omit<HTMLProps<HTMLInputElement>, 'onChange' | 'value'>;\ninterface IProps extends InputProps {\n  min: number;\n  max: number;\n  step: number;\n  value: number;\n  onChange: (value: number) => void;\n}\n\nconst NumberInput: React.FC<IProps> = ({ min, max, step, value, onChange, ...props }) => {\n  const valid = (value: number) => !isNaN(value) && min <= value && value <= max\n  if (!valid(value)) throw new Error(`invalid value \"${value}\"`);\n  const updateValue = throttle(onChange);\n  const [localValue, setLocalValue] = useState<number>(value);\n\n\n  function commitChange(_value: number) {\n    if (valid(_value)) {\n      setLocalValue(_value);\n      updateValue(_value);\n    } else {\n      setLocalValue(value);\n    }\n  }\n\n  function handleInputChange(event: React.ChangeEvent) {\n    const target = event.target as HTMLInputElement;\n    setLocalValue(Number(target.value));\n  }\n\n  function handleBlur(event: React.SyntheticEvent) {\n    const target = event.target as HTMLInputElement;\n    const value = parseInt(target.value, 10);\n    commitChange(value);\n  }\n\n  const increment = () => {\n    const value = localValue + step;\n    if (!valid(value)) return;\n    commitChange(value)\n  }\n\n  const decrement = () => {\n    const value = localValue - step;\n    if (!valid(value)) return;\n    commitChange(value)\n  }\n\n  const keyHandlers = {\n    [KEY.DOWN]: decrement,\n    [KEY.UP]: increment\n  }\n\n  function handleKeyDown(event: React.KeyboardEvent) {\n    const fn = keyHandlers[event.keyCode];\n    if (!fn) return;\n    fn();\n  }\n\n  return (\n    <input\n      {...props}\n      type=\"text\"\n      inputMode=\"numeric\"\n      pattern=\"[0-9]*\"\n      onBlur={handleBlur}\n      onChange={handleInputChange}\n      onKeyDown={handleKeyDown}\n      value={localValue}\n    />\n  )\n}\n\nexport default NumberInput\n","import React, { useEffect, useState } from 'react';\nimport './SleepMachine.css'\nimport ProgressMeter from './ProgressMeter';\nimport PlayPauseButton from './PlayPauseButton';\nimport MarkovChart from './MarkovChart';\nimport Controls from './Controls';\nimport Machine from '../lib/machine'\nimport NumberInput from './NumberInput';\n\nconst LABELS = ['C', 'D', 'E', 'F', 'G', 'A', 'B']\nconst INITIAL_WEIGHTS = [\n  [0.00, 0.09, 0.06, 0.30, 0.40, 0.15, 0],\n  [0.18, 0.00, 0.13, 0.22, 0.22, 0.25, 0],\n  [0.06, 0.10, 0.00, 0.41, 0.10, 0.33, 0],\n  [0.38, 0.06, 0.04, 0.00, 0.38, 0.14, 0],\n  [0.27, 0.07, 0.05, 0.27, 0.00, 0.34, 0],\n  [0.16, 0.09, 0.09, 0.36, 0.30, 0.00, 0],\n  [0.16, 0.16, 0.16, 0.16, 0.16, 0.16, 0]\n];\n\nconst machine = new Machine(INITIAL_WEIGHTS);\n\ninterface IProps { }\n\nfunction useMachine(machine: Machine): [number, number, number | undefined, boolean, (playing: boolean) => void] {\n  const [playing, _setPlaying] = useState<boolean>(false);\n  const [beat, setBeat] = useState<number>(0);\n  const [current, setCurrent] = useState<number>(0);\n  const [next, setNext] = useState<number | undefined>(undefined);\n\n  function setPlaying(value: boolean) {\n    _setPlaying(value);\n  }\n\n  useEffect(() => {\n    machine.on('select', (next, current) => {\n      setNext(next);\n    }).on('change', (pattern, active) => {\n      setNext(undefined);\n      setCurrent(active);\n    }).on('beat', (beat) => {\n      setBeat(beat)\n    });\n\n    return () => machine.stop();\n  }, [])\n\n  return [beat, current, next, playing, setPlaying]\n}\n\nconst KEYCODE = {\n  SPACEBAR: 32\n};\n\nconst SleepMachine: React.FC<IProps> = () => {\n  const [beat, current, next, playing, setPlaying] = useMachine(machine)\n\n  function handlePlayPause() {\n    const machineState = machine.state === 'started'\n    setPlaying(!machineState)\n    machine.toggle();\n  }\n\n  useEffect(() => {\n    function handleKeyDown(event: KeyboardEvent) {\n      // TODO: on my machine, spacebar will toggle a focused button element.\n      // this means that if the PlayPauseButton is focused then spacebar\n      // keypresses will toggle the machine state twice. as a work around.\n      // we can ignore spacebar keypresses if the activeElement is the\n      // PlayPauseButton. it might be safer to use a throttle or debounce\n      // here instead\n      if (document.activeElement?.classList.contains('PlayPauseButton')) return\n      if (event.keyCode === KEYCODE.SPACEBAR) return handlePlayPause();\n    }\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, []);\n\n  function handleWeightsChange(weights: number[][]) {\n    machine.updateProbabilities(weights);\n  }\n\n  return (\n    <div className=\"SleepMachine-container\">\n      <header className=\"SleepMachine-header\">\n        <h1 className=\"wordmark\">\n          <span>Zzz Machine</span><br />\n          <small>\n            <em>by <a href=\"https://twitter.com/jordanstephens\">@jordanstephens</a></em>\n            {' • '}\n            <a href=\"https://github.com/jordanstephens/sleep-machine\">Source</a>\n          </small>\n        </h1>\n        <div className=\"transport-controls-container\">\n          <div className=\"transport-controls\">\n            <div className=\"ProgressMeter-container\">\n              {playing && (\n                <ProgressMeter beat={beat} />\n              )}\n            </div>\n            <NumberInput\n              id=\"tempo\"\n              name=\"tempo\"\n              min={60}\n              max={180}\n              step={1}\n              value={Math.round(machine.params.tempo)}\n              onChange={(tempo) => machine.updateParams({ tempo })}\n              className=\"tempo-input\"\n            />\n            <small>bpm</small>\n          </div>\n        </div>\n      </header>\n      <main className=\"App-main\">\n        {!playing && (\n          <div className=\"overlay\">\n            <div className=\"start-message\" onClick={handlePlayPause}>\n              <div style={{ marginBottom: '1rem', height: '3.5rem', width: '3.5rem' }}>\n                <PlayPauseButton playing={false} onClick={() => { }} />\n              </div>\n              Play\n            </div>\n          </div>\n        )}\n        <div className=\"SleepMachine\">\n          <div className=\"viz-container\">\n            <div className=\"MarkovChart-container\">\n              <MarkovChart\n                labels={LABELS}\n                current={current}\n                next={next}\n                weights={machine.probabilities}\n                onChange={handleWeightsChange}\n              />\n            </div>\n          </div>\n          <div className=\"Controls-container\">\n            <Controls\n              beat={beat}\n              params={machine.params}\n              onChange={machine.updateParams}\n            />\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n\nexport default SleepMachine;\n","import React from 'react';\nimport './App.css'\nimport SleepMachine from './components/SleepMachine';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <SleepMachine />\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}